<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0">
  <title>Stencil Component Starter</title>

  <script type="module" src="/build/kg-dataset-previewer.esm.js"></script>
  <script nomodule src="/build/kg-dataset-previewer.js"></script>
  <style>
    html, body, .container
    {
      width: 100%;
      height: 100%;
      display: block;
    }

    .container
    {
      width: 100%;
      display: flex!important;
      flex-direction: column;
    }

    .row
    {
      display: flex!important;
      flex-direction: row;
    }
    .row > *
    {
      flex-grow: 1;
    }
  </style>
  <script id="MathJax-script" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.1.2/es5/tex-svg.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/6.2.0/d3.min.js"></script>
</head>
<body>
  <label for="darkmode-checkbox">
    <input type="checkbox" id="darkmode-checkbox">darkmode
  </label>

  <div class="container">
    <div class="row" id="first-row">
    </div>
    <div class="row">

      <kg-ds-prv-regional-feature-view
        style="display:block;"
        kg-ds-prv-kg-id="64f588b5-5a04-4ed7-abba-ae1d09671dfe"
        kg-ds-prv-filename="PFcm_fp_20180405.tsv">
      </kg-ds-prv-regional-feature-view>
      <kg-ds-prv-regional-feature-view
        style="display:block;"
        kg-ds-prv-kg-id="64f588b5-5a04-4ed7-abba-ae1d09671dfe"
        kg-ds-prv-filename="PFcm_fp_20180405.tsv">
      </kg-ds-prv-regional-feature-view>
      <kg-ds-prv-regional-feature-view
        style="display:block;"
        kg-ds-prv-kg-id="64f588b5-5a04-4ed7-abba-ae1d09671dfe"
        kg-ds-prv-filename="PFcm_fp_20180405.tsv">
      </kg-ds-prv-regional-feature-view>
    </div>
  </div>
  
  <div class="container">
    <div class="row">
      <kg-ds-prv-regional-feature-view
        style="display:block;"
        kg-ds-prv-kg-id="e715e1f7-2079-45c4-a67f-f76b102acfce"
        kg-ds-prv-filename="hOc1_ar_examples/M2/hOc1_ar_M2.tif">
      </kg-ds-prv-regional-feature-view>
      <kg-ds-prv-regional-feature-view
        style="display:block;"
        kg-ds-prv-kg-id="e715e1f7-2079-45c4-a67f-f76b102acfce"
        kg-ds-prv-filename="hOc1_pr_examples/5-HT1A/hOc1_pr_5-HT1A.tsv">
      </kg-ds-prv-regional-feature-view>
      <kg-ds-prv-regional-feature-view
        id="test-1"
        style="display:block;"
        kg-ds-prv-kg-id="e715e1f7-2079-45c4-a67f-f76b102acfce"
        kg-ds-prv-filename="hOc1_fp_20171202.tsv">
      </kg-ds-prv-regional-feature-view>
    </div>
    <div class="row">

      <kg-dataset-previewer
        style="display:block; width: 500px; height: 500px;"
        kg-ds-prv-kg-id="e715e1f7-2079-45c4-a67f-f76b102acfce"
        kg-ds-prv-filename="hOc1_pr_examples/5-HT1A/hOc1_pr_5-HT1A.tsv">
      </kg-dataset-previewer>
      <kg-dataset-previewer
        style="display:block; width: 500px; height: 500px;"
        kg-ds-prv-kg-id="e715e1f7-2079-45c4-a67f-f76b102acfce"
        kg-ds-prv-filename="hOc1_fp_20171202.tsv">
      </kg-dataset-previewer>
    </div>

    <div class="row">

      <kg-dataset-list
        kg-ds-prv-container-class="ul-container test-container"
        kg-ds-prv-item-class="item-class"
        kg-ds-prv-kg-id="e715e1f7-2079-45c4-a67f-f76b102acfce">
      
      </kg-dataset-list>

      <kg-dataset-list
        kg-ds-prv-container-class="ul-container test-container"
        kg-ds-prv-item-class="item-class"
        kg-ds-prv-backend-url="http://localhost:1234/v2"
        kg-ds-prv-filter-criteria='["neuroglancer/seeg/coordinate/v1.0.0/188ced88-c43a-4e7f-a8e8-e60d2e995f7a"]'
        kg-ds-prv-kg-id="154e9d64-27aa-458d-a289-3e42e4269235">
      
      </kg-dataset-list>

      <kg-dataset-previewer
        style="width: 800px; border:1px black solid;"
        kg-ds-prv-kg-id="e715e1f7-2079-45c4-a67f-f76b102acfce"
        kg-ds-prv-filename="hOc1_ar_examples/M2/hOc1_ar_M2.tif">
      </kg-dataset-previewer>

      <kg-dataset-previewer
        style="width: 200px; height: 200px; border:1px black solid;"
        kg-ds-prv-kg-id="e715e1f7-2079-45c4-a67f-f76b102acfce"
        kg-ds-prv-filename="hOc1_ar_examples/kainate/hOc1_ar_kainate.tif">
      </kg-dataset-previewer>

      <kg-dataset-previewer
        style="width: 200px; border:1px black solid;"
        kg-ds-prv-kg-id="ca952092-3013-4151-abcc-99a156fe7c83"
        kg-ds-prv-filename="HiBoP preview file 001">
      </kg-dataset-previewer>
    </div>
    <div class="row">

      <div id="btn-container">

      </div>
    </div>
  </div>
</body>
<script>
  const checkbox = document.getElementById('darkmode-checkbox')
  if (!checkbox) throw new Error(`checkbox not found`)

  const kgDsPrvs = document.querySelectorAll('kg-dataset-previewer')
  const kgDsRegFeat = document.querySelectorAll('kg-ds-prv-regional-feature-view')
  const kgDsLists = document.querySelectorAll('kg-dataset-list')

  const container = document.getElementById('btn-container')

  for (const prv of kgDsPrvs) {
    prv.addEventListener('renderEvent', async () => {
      try{

        const imgHref = await prv.getDownloadPreviewHref()
        const csvHref = await prv.getDownloadCsvHref()
        console.log({ imgHref, csvHref })
        
        const a1 = document.createElement('a')
        a1.href = csvHref
        a1.text = `a1 csv`
        a1.setAttribute('download', 'a1.csv')
        const a2 = document.createElement('a')
        a2.href = imgHref
        a2.text = `a2 img`

        container.appendChild(a1)
        container.appendChild(a2)
      }catch(e) {
        console.warn(e)
      }
    })
  }

  for (const list of kgDsLists){
    list.addEventListener('kgDsPrvUpdated', ({ detail }) => {
      console.log('kgDsPrvUpdated fired', detail)
    })
  }
  document.addEventListener('change', (ev) => {
    const { checked } = checkbox
    const tagsTobeToggled = [
      'kg-dataset-previewer',
      'kg-ds-prv-regional-feature-view',
      'kg-dataset-dumb-line',
      'kg-dataset-dumb-radar',
    ]

    for (const tag of tagsTobeToggled) {
      const els = document.querySelectorAll(tag)

      for (const el of els){
        el.setAttribute('kg-ds-prv-darkmode', checked)
        if (el.getDownloadPreviewHref )el.getDownloadPreviewHref()
      }
    }


    if (checked) {
      document.body.style.backgroundColor = `rgb(30,30,30)`
    } else {
      document.body.style.backgroundColor = `rgb(255,255,255)`
    }
  })

  const s = (async () => {

    const json = await fetch(`http://localhost:1234/v2/_bs`).then(res => res.json())
    const profileBs = json.data._ReceptorDistribution__profiles['5-HT1A']

    const container = document.querySelector('#first-row')

    const dumbLineEl = document.createElement('kg-dataset-dumb-line')
    dumbLineEl.profileBs = profileBs
    container.appendChild(dumbLineEl)
    
    const dumbRadarEl = document.createElement('kg-dataset-dumb-radar')
    const radarBs = json.data._ReceptorDistribution__fingerprint
    dumbRadarEl.radarBs = radarBs
    dumbRadarEl.metaBs = json.receptor_symbols
    container.appendChild(dumbRadarEl)

    const autoBs = json.data['_ReceptorDistribution__autoradiographs']['5-HT1A']
    const query = autoBs.replace('https://object.cscs.ch/v1', '')
    const imgEl = document.createElement('img')
    imgEl.src = `http://localhost:1234/v2/imageProxy/v1?u=${encodeURIComponent(query)}`
    imgEl.style.maxWidth = `20em`
    imgEl.style.height = `auto`
    imgEl.style.display = `inline-block`
    container.appendChild(imgEl)
  })()
    
</script>
</html>
